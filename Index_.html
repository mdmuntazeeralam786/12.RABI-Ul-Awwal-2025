<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>12 Rabi Ul Awwal ‚Äì Eid Milad-un-Nabi ‚Ä¢ Celebration</title>
<style>
  /* ============== Core Layout (No Scrolling) ============== */
  :root{
    /* Islamic dark neon / emerald theme */
    --bg1:#072b1f;     /* deep emerald */
    --bg2:#021926;     /* deep navy-green */
    --gold:#ffd166;
    --emerald:#00d08a;
    --teal:#13e8ff;
    --accent1:#a0ffcb;
    --whatsapp:#25D366;
    --text:#f6f7ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    background: radial-gradient(80vw 80vh at 50% 0%, #0a2b1e 0%, var(--bg1) 45%, var(--bg2) 100%);
    color:var(--text);
    overflow:hidden; /* no vertical scroll anywhere */
    -webkit-font-smoothing:antialiased;
    text-rendering:optimizeLegibility;
  }
  .viewport{
    position:fixed; inset:0; width:100vw; height:100vh; overflow-y: auto; /* Changed from hidden to auto */
  }

  /* ============== Landing Screen ============== */
  .landing{
    position:absolute; inset:0; display:grid; place-items:center; z-index:40;
    background:
      radial-gradient(120vw 120vh at 10% 20%, rgba(24,87,54,0.85) 0%, transparent 60%),
      radial-gradient(120vw 120vh at 90% 80%, rgba(2,25,38,0.7) 0%, transparent 60%),
      conic-gradient(from 0deg, #0ff3d4, #ffd166, #00f0ff, #7affb1, #ffd166);
    animation: hueShift 10s linear infinite, slowZoom 14s ease-in-out infinite;
  }
  .landing::after{
    content:"";
    position:absolute; inset:-5vmax;
    background: radial-gradient(60vmax 60vmax at 50% 50%, rgba(255,255,255,0.04), rgba(255,255,255,0));
    filter: blur(40px);
    pointer-events:none;
  }
  .card{
    width:min(90vw, 820px);
    padding: clamp(18px, 4.5vmin, 40px);
    border-radius:28px;
    background: rgba(0,0,0,0.36);
    box-shadow:
      0 0 0 1px rgba(255,255,255,0.04),
      0 20px 80px rgba(0,0,0,0.55),
      inset 0 0 60px rgba(255,255,255,0.03);
    backdrop-filter: blur(10px);
    text-align:center;
  }
  .landing h1{
    margin:0 0 24px;
    font-size: clamp(26px, 6vw, 56px);
    letter-spacing:0.5px;
    line-height:1.12;
    background: linear-gradient(120deg, #fff, var(--gold) 25%, var(--teal) 50%, #bfffe6 75%, #fff);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow: 0 0 12px rgba(255,255,255,0.15);
    animation: discoText 6s linear infinite;
  }
  .btn{
    display:inline-flex; align-items:center; justify-content:center; gap:10px;
    padding:14px 22px; border-radius:999px; border:1px solid rgba(255,255,255,0.12);
    color:#04120b; font-weight:700; text-transform:none; letter-spacing:.2px;
    background: radial-gradient(120% 120% at 10% 10%, var(--gold), #ffd88a 30%, var(--teal) 100%);
    box-shadow:
      0 0 28px rgba(255,209,102,0.40),
      inset 0 0 18px rgba(255,255,255,0.28);
    cursor:pointer; user-select:none;
    transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    animation: pulseGlow 2.4s ease-in-out infinite;
  }
  .btn:hover{ transform: translateY(-2px) scale(1.02); filter:brightness(1.03); }
  .btn:active{ transform: translateY(0) scale(0.99); }

  /* Small crescent decoration top-left */
  .crescent {
    position:absolute; left:18px; top:18px; z-index:45;
    width:72px; height:72px; border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,230,130,0.95), rgba(255,200,80,0.9));
    box-shadow: 0 0 30px rgba(255,210,110,0.22), inset -12px -6px 28px rgba(0,0,0,0.08);
    transform: rotate(-18deg);
    filter: drop-shadow(0 6px 18px rgba(0,0,0,0.45));
  }
  .crescent::after{
    content:""; position:absolute; right:-14px; top:-6px;
    width:72px; height:72px; border-radius:50%;
    background: radial-gradient(circle at 40% 40%, rgba(0,0,0,0), rgba(0,0,0,0.35));
    mix-blend-mode: multiply;
  }

  /* ============== Celebration Screen ============== */
  .scene{
    position:absolute; inset:0; z-index:1; display:flex; flex-direction:column;
    align-items:center; justify-content:flex-start; padding: clamp(10px, 3vmin, 20px);
    opacity:0; pointer-events:none; transition:opacity .8s ease;
  }
  .scene.active{ opacity:1; pointer-events:auto; }
  .topWrap{ width:100%; display:flex; flex-direction:column; align-items:center; gap: clamp(8px, 2vmin, 14px); padding-top: clamp(12px, 3.4vmin, 36px); }

  /* Main Image (was Rakhi) */
  .mainImage{
    width:min(96vw, 720px);
    height:auto;
    border-radius:22px;
    box-shadow:
      0 18px 55px rgba(0,0,0,0.55),
      0 0 0 2px rgba(255,255,255,0.06),
      0 0 40px 12px rgba(255,209,102,0.12),
      0 0 60px 18px rgba(0,240,170,0.12);
    animation: imgPulse 5.5s ease-in-out infinite, shadowCycle 7s linear infinite;
    background-size:cover; background-position:center;
  }

  /* Headline "Eid Milad-un-Nabi Mubarak" with glow plate */
  .headlineWrap{
    position:relative; display:inline-block; margin-top: clamp(6px, 1.4vmin, 10px);
    padding: clamp(6px, 1.2vmin, 12px) clamp(12px, 2vmin, 20px);
    border-radius:18px;
  }
  .headlineWrap::before{
    content:""; position:absolute; inset:-8px;
    background: linear-gradient(120deg, var(--emerald), var(--teal));
    filter: blur(18px); z-index:-1; border-radius:22px; opacity:.95;
    animation: hueShift 6s linear infinite reverse;
  }
  .headline{
    margin:0; font-size: clamp(26px, 6.2vw, 64px); font-weight:900; line-height:1.05; letter-spacing:.5px;
    background: conic-gradient(from 0deg, #fff, var(--gold), #fff, #bfffe6, #ffd1f8, #fff);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow: 0 0 18px rgba(255,255,255,0.18);
    animation: discoText 4.5s linear infinite, softBlink 2.6s ease-in-out infinite;
    white-space:nowrap;
  }

  /* Greeting Line */
  .greetingWrap{
    position:relative; margin-top: clamp(8px, 1.8vmin, 14px);
    padding: clamp(10px, 2vmin, 16px) clamp(12px, 2.2vmin, 20px);
    border-radius:16px;
    background: linear-gradient(120deg, rgba(0,208,138,.12), rgba(255,209,102,.10));
    box-shadow: inset 0 0 30px rgba(255,255,255,0.03), 0 8px 30px rgba(0,0,0,0.35);
  }
  .greeting{
    margin:0;
    font-size: clamp(18px, 4.2vw, 36px);
    line-height:1.2;
    text-align:center;
  }
  .name{
    color:var(--gold);
    text-shadow: 0 0 16px rgba(255,209,102,.9), 0 0 26px rgba(0,208,138,.7);
    animation: nameGlow 3s ease-in-out infinite, gentleZoom 3.8s ease-in-out infinite;
    font-weight:900;
  }
  .msg{
    color:#eaf9ff;
    text-shadow: 0 0 10px rgba(0,240,170,.3);
    display:inline-block; margin-left:8px;
  }

  /* Controls Panel */
  .panel{
    /* position:absolute; left:50%; bottom: clamp(8px, 2.2vmin, 18px); transform: translateX(-50%); */ /* Removed absolute positioning */
    margin: 20px auto; /* Added margin to center and add space */
    width:min(96vw, 940px);
    display:flex; flex-wrap:wrap; gap: clamp(8px, 1.6vmin, 14px);
    align-items:center; justify-content:center;
    background: rgba(0,0,0,0.36); border:1px solid rgba(255,255,255,.06);
    padding: clamp(10px, 2vmin, 18px); border-radius:20px;
    box-shadow: 0 12px 60px rgba(0,0,0,0.48), inset 0 0 40px rgba(255,255,255,0.04);
    backdrop-filter: blur(10px);
  }
  .input{
    flex:1 1 240px; min-width:240px; max-width:420px;
    display:flex; flex-direction:column; gap:10px;
  }
  label{ font-size:12px; opacity:.9; letter-spacing:.3px; color:rgba(255,255,255,0.9)}
  input[type="text"], textarea{
    width:100%; padding:12px 14px; border-radius:14px; border:1px solid transparent;
    background: rgba(255,255,255,0.04); color:var(--text);
    outline:none;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04), 0 0 18px rgba(0,0,0,0.25);
    transition: border .18s ease, box-shadow .18s ease;
  }
  input[type="text"]:focus, textarea:focus{
    border:1px solid var(--emerald); box-shadow: 0 0 20px rgba(0,208,138,.25), inset 0 0 0 1px rgba(255,255,255,0.04);
  }
  textarea{ resize:none; height:62px }

  .gift-button{
    text-decoration:none; color:#04120b; font-weight:900;
    padding:14px 18px; border-radius:16px; white-space:nowrap;
    background: linear-gradient(135deg, var(--gold), #ffb347 30%, #ffd54a 75%);
    box-shadow: 0 16px 44px rgba(255,184,46,.28), inset 0 0 26px rgba(255,255,255,.32);
    border:1px solid rgba(255,255,255,.16);
    position:relative; display:inline-flex; align-items:center; gap:10px;
    animation: pulseGlow 2.4s ease-in-out infinite, bounce 2.6s ease-in-out infinite;
  }
  .gift-hand{ display:inline-block; animation: handNudge 1.6s ease-in-out infinite; filter: drop-shadow(0 0 8px rgba(255,255,255,.45)); }
  .share{
    display:inline-flex; align-items:center; gap:10px; padding:12px 16px;
    border-radius:999px; color:#fff; background:var(--whatsapp);
    text-decoration:none; font-weight:800; border:1px solid rgba(255,255,255,.14);
    box-shadow: 0 0 28px rgba(37,211,102,.45), inset 0 0 18px rgba(255,255,255,.2);
    transition: transform .16s ease, filter .16s ease; white-space:nowrap;
  }
  .share:hover{ transform:translateY(-2px) scale(1.02); filter:brightness(1.05); }
  .wa-logo{ width:18px; height:18px; }

  /* Canvas Layers (confetti/sparkles/fireworks/balloons/petals) */
  canvas.layer{ position:absolute; inset:0; width:100%; height:100%; pointer-events:none; z-index:5; }
  .overlay{ position:absolute; inset:0; pointer-events:none; z-index:6; }

  /* ============== Animations ============== */
  @keyframes hueShift{ to{ filter:hue-rotate(360deg);} }
  @keyframes slowZoom{ 0%,100%{ transform: scale(1);} 50%{ transform: scale(1.05);} }
  @keyframes discoText{ to{ filter:hue-rotate(360deg);} }
  @keyframes softBlink{ 0%,100%{ opacity:1 } 50%{ opacity:.8 } }
  @keyframes pulseGlow{
    0%,100%{ box-shadow: 0 0 22px rgba(255,209,102,.28), inset 0 0 16px rgba(255,255,255,.18);}
    50%{ box-shadow: 0 0 36px rgba(0,240,170,.45), inset 0 0 26px rgba(255,255,255,.28);}
  }
  @keyframes imgPulse{ 0%,100%{ transform:scale(1)} 50%{ transform:scale(1.02)} }
  @keyframes shadowCycle{
    0%{ box-shadow: 0 18px 55px rgba(0,0,0,0.55), 0 0 0 2px rgba(255,255,255,0.04), 0 0 40px 12px rgba(255,209,102,0.14), 0 0 60px 18px rgba(0,240,170,0.10); }
    50%{ box-shadow: 0 18px 55px rgba(0,0,0,0.55), 0 0 0 2px rgba(255,255,255,0.04), 0 0 40px 12px rgba(255,215,120,0.14), 0 0 60px 18px rgba(0,200,140,0.12); }
    100%{ box-shadow: 0 18px 55px rgba(0,0,0,0.55), 0 0 0 2px rgba(255,255,255,0.04), 0 0 40px 12px rgba(255,209,102,0.14), 0 0 60px 18px rgba(0,240,170,0.10); }
  }
  @keyframes nameGlow{
    0%,100%{ text-shadow: 0 0 8px rgba(255,209,102,.9), 0 0 18px rgba(0,208,138,.7) }
    50%   { text-shadow: 0 0 18px rgba(255,235,140,1), 0 0 30px rgba(0,240,170,.85)}
  }
  @keyframes gentleZoom{ 0%,100%{ transform:scale(1)} 50%{ transform:scale(1.03)} }
  @keyframes bounce{ 0%,100%{ transform:translateY(0) } 50%{ transform:translateY(-5px) } }
  @keyframes handNudge{ 0%,100%{ transform:translateX(0) } 50%{ transform:translateX(6px) } }

  /* Responsive fine-tuning to keep everything inside one viewport */
  @media (max-height:760px){
    .headline{ font-size: clamp(22px, 5.5vw, 44px); }
    .greeting{ font-size: clamp(16px, 3.8vw, 28px); }
    .panel{ transform: scale(.97); } /* Adjusted transform */
  }
  @media (max-height:560px){
    .mainImage{ width:min(92vw, 560px); }
    .panel{ transform: scale(.92); } /* Adjusted transform */
  }
</style>
</head>
<body>
<div class="viewport">

  <!-- Decorative Crescent (Islamic) -->
  <div class="crescent" aria-hidden="true"></div>

  <!-- ===================== Landing Screen ===================== -->
  <section class="landing" id="landing">
    <div class="card">
      <h1>Special 12 Rabi Ul Awwal message waiting for you</h1>
      <button id="revealBtn" class="btn" aria-label="Reveal celebration">
        ‚ú® Click to Reveal ‚ú®
      </button>
    </div>
  </section>

  <!-- ===================== Celebration Screen ===================== -->
  <section class="scene" id="scene">
    <!-- Effects Layers -->
    <canvas class="layer" id="confetti"></canvas>
    <canvas class="layer" id="sparkfire"></canvas>
    <div class="overlay" id="floaters"></div> <!-- balloons + flowers (emojis) -->

    <div class="topWrap">
      <!-- Main image for 12 Rabi Ul Awwal -->
      <img src="12rabiulawal.jpg" alt="12 Rabi Ul Awwal image" class="mainImage" id="mainImg" />

      <div class="headlineWrap" role="heading" aria-level="2">
        <h2 class="headline">Eid Milad-un-Nabi Ô∑∫ Mubarak</h2>
      </div>

      <div class="greetingWrap" aria-live="polite">
        <p class="greeting">
          <span class="name" id="nameOut">Someone</span>
          <span class="msg">ki taraf se:</span>
          <span class="msg" id="msgOut">aapko 12 Rabi Ul Awwal ki bahut bahut mubarakbaad</span>
        </p>
      </div>
    </div>

    <!-- Controls / Share -->
    <div class="panel" role="region" aria-label="Share and input controls">
      <div class="input">
        <label for="nameIn">Enter your name</label>
        <input id="nameIn" type="text" placeholder="e.g., Ahmed / Ayesha" />
      </div>
      <div class="input">
        <label for="msgIn">Type your message</label>
        <textarea id="msgIn" placeholder="Write your Eid Milad-un-Nabi wish here..."></textarea>
      </div>

      <!-- üî•üî• PASTE YOUR AMAZON AFFILIATE LINK BELOW üî•üî• -->
      <a href="YOUR_AFFILIATE_LINK" target="_blank" class="gift-button" id="giftBtn" rel="noopener">
        üéÅ Special Eid Gifts üéÅ <span class="gift-hand">üëÜ</span>
      </a>

      <a class="share" id="waShare" href="#" rel="noopener" target="_blank" aria-label="Share on WhatsApp">
        <svg class="wa-logo" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path fill="currentColor" d="M19.1 17.2c-.3-.1-1.9-.9-2.2-1.1-.3-.1-.5-.1-.7.1s-.8 1-.9 1.1c-.2.1-.3.2-.6.1-.3-.1-1.3-.5-2.4-1.5-.9-.8-1.5-1.8-1.7-2.1-.2-.3 0-.5.1-.6.1-.1.3-.3.4-.4.1-.1.2-.3.3-.4.1-.1.1-.3 0-.5-.1-.1-.7-1.7-.9-2.3-.2-.6-.5-.5-.7-.5h-.6c-.2 0-.5.1-.7.3-.2.2-.9.9-.9 2.2s.9 2.6 1 2.7c.1.1 1.7 2.7 4.1 3.8 2.5 1.1 2.5.7 3 .7.5 0 1.6-.6 1.9-1.2.2-.6.2-1.1.2-1.2-.1-.1-.3-.2-.6-.3zM26.6 5.4C23.7 2.5 20 1 16.1 1 8.4 1 2.1 7.3 2.1 15c0 2.4.6 4.7 1.7 6.7L2 31l9.5-1.8c1.9 1 4 1.5 6.2 1.5 7.7 0 14-6.3 14-14 0-3.9-1.5-7.6-4.4-10.3zM16.1 28.1c-2 0-3.9-.5-5.6-1.4l-.4-.2-5.6 1.1 1.1-5.4-.3-.4c-1.1-1.8-1.6-3.9-1.6-6 0-6.4 5.2-11.6 11.6-11.6 3.1 0 6 1.2 8.2 3.4s3.4 5.1 3.4 8.2c0 6.5-5.2 11.7-11.6 11.7z"/>
        </svg>
        Share on WhatsApp
      </a>
    </div>
  </section>

  <!-- Hidden audio (starts after click) -->
  <audio id="bgm" src="12rabiulawal.mp3" preload="auto" loop></audio>
</div>

<script>
/* =========================================================
   12 Rabi Ul Awwal ‚Äì Eid Milad-un-Nabi Celebration ‚Äì Single File Script
   - Landing -> Celebration transition
   - URL param handling for name & message
   - Music + music-reactive confetti/sparkles/fireworks
   - Balloons + Flower emoji fall (reduced density)
   - WhatsApp sharing with deep-link incl. ?name & ?msg
   - All logic preserved from original design, replaced texts & assets
   ========================================================= */

(function(){
  const qs = new URLSearchParams(location.search);
  const defaultName = "Someone";
  const defaultMsg  = "aapko 12 Rabi Ul Awwal ki bahut bahut mubarakbaad";

  const nameParam = (qs.get("name") || "").trim();
  const msgParam  = (qs.get("msg")  || "").trim();

  const landing   = document.getElementById('landing');
  const scene     = document.getElementById('scene');
  const revealBtn = document.getElementById('revealBtn');

  const nameOut = document.getElementById('nameOut');
  const msgOut  = document.getElementById('msgOut');
  const nameIn  = document.getElementById('nameIn');
  const msgIn   = document.getElementById('msgIn');

  const waShare  = document.getElementById('waShare');
  const bgm      = document.getElementById('bgm');

  // Set initial values from URL or defaults
  const initName = nameParam || defaultName;
  const initMsg  = msgParam  || defaultMsg;
  nameOut.textContent = initName;
  msgOut.textContent  = initMsg;
  nameIn.value = nameParam || "";
  msgIn.value  = msgParam  || "";

  // Live update greeting as user types (if no URL param given)
  function updateGreeting(){
    const n = (nameIn.value || initName || defaultName).trim();
    const m = (msgIn.value  || initMsg  || defaultMsg ).trim();
    nameOut.textContent = n;
    msgOut.textContent  = m;
    buildShareLink(n, m);
  }

  nameIn.addEventListener('input', updateGreeting);
  msgIn.addEventListener('input', updateGreeting);

  function buildShareLink(n, m){
    // Construct sharable URL: https://example.com/?name=Ahmed&msg=Mubarak%20...
    const base = location.origin + location.pathname;
    const url  = base + '?name=' + encodeURIComponent(n) + '&msg=' + encodeURIComponent(m);
    const text = `${n} ki taraf se: ${m} ‚Äî Open: ${url}`;
    const wa   = 'https://wa.me/?text=' + encodeURIComponent(text);
    waShare.href = wa;
    waShare.setAttribute('data-share-url', url);
  }
  buildShareLink(initName, initMsg);

  // ====== Reveal: play music, start effects, fade landing ======
  let audioStarted = false;
  let audioCtx, analyser, dataArray;

  revealBtn.addEventListener('click', async () => {
    scene.classList.add('active');
    landing.style.transition = 'opacity .6s ease';
    landing.style.opacity = '0';
    setTimeout(()=> landing.style.display = 'none', 650);

    // Start audio chain
    if(!audioStarted){
      try{
        await bgm.play(); // user gesture => allowed
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioCtx.createMediaElementSource(bgm);
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 1024;
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        source.connect(analyser);
        analyser.connect(audioCtx.destination);
        audioStarted = true;
        startReactiveEffects();
      }catch(e){
        console.warn('Autoplay blocked or audio error:', e);
      }
    }else{
        // resume if already created but possibly suspended
        if(audioCtx && audioCtx.state === 'suspended'){ audioCtx.resume(); }
        bgm.play().catch(()=>{});
    }
  });

  // If page loaded with params, auto-fill greeting; music still only after click
  updateGreeting();

  /* =================== Visual Effects =================== */
  // Confetti/Sparkles/Fireworks (canvas)
  const canvasC = document.getElementById('confetti');
  const ctxC    = canvasC.getContext('2d');
  const canvasS = document.getElementById('sparkfire');
  const ctxS    = canvasS.getContext('2d');

  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  function sizeCanvases(){
    [canvasC, canvasS].forEach(c=>{
      c.width  = Math.floor(c.clientWidth * DPR);
      c.height = Math.floor(c.clientHeight* DPR);
    });
  }
  sizeCanvases();
  addEventListener('resize', sizeCanvases);

  // Particles
  const confetti = [];
  const sparks   = [];
  const fireworks= [];

  function rand(min, max){ return Math.random()*(max-min)+min; }
  function choose(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  // Islamic neon palette (greens & golds)
  const neon = ['#ffd166','#00d08a','#13e8ff','#a0ffcb','#ffd1a3','#7affb1','#ffd9a6'];

  // Music-reactive intensity
  let intensity = 0.18; // baseline
  function getLevel(){
    if(!analyser || !dataArray) return 0;
    analyser.getByteFrequencyData(dataArray);
    // weight mid-bass more (indexes ~5..40)
    let sum=0, count=0;
    for(let i=5;i<40 && i<dataArray.length;i++){ sum += dataArray[i]; count++; }
    const avg = count ? sum / count : 0;
    return avg/255; // 0..1
  }

  function spawnConfetti(amount){
    for(let i=0;i<amount;i++){
      confetti.push({
        x: rand(0, canvasC.width),
        y: -10,
        vx: rand(-0.5,0.5),
        vy: rand(1.2,2.6),
        r: rand(2,4)*DPR,
        rot: rand(0, Math.PI*2),
        vr: rand(-0.1,0.1),
        c: choose(neon)
      });
    }
  }
  function spawnSpark(x,y,amount=10){
    for(let i=0;i<amount;i++){
      sparks.push({
        x, y,
        vx: rand(-2.0,2.0),
        vy: rand(-2.0,2.0),
        life: rand(18,36),
        c: choose(neon)
      });
    }
  }
  function spawnFirework(){
    const x = rand(0.15,0.85)*canvasS.width;
    const y = rand(0.2,0.6)*canvasS.height;
    fireworks.push({x,y,t:0,c:choose(neon)});
    spawnSpark(x,y, rand(16,26));
  }

  // Balloons + Flowers (DOM elements)
  const floaters = document.getElementById('floaters');
  const flowerEmojis = ["üåô","üå∫","üíê","ü•Ä","üåπ","üå∏","üåº","üåª","üïå"];
  function spawnFlower(){
    const el = document.createElement('div');
    el.textContent = choose(flowerEmojis);
    el.style.position='absolute';
    el.style.left = rand(0, 100) + 'vw';
    el.style.top  = '-6vh';
    el.style.fontSize = rand(16, 28) + 'px';
    el.style.filter = 'drop-shadow(0 0 6px rgba(0,0,0,0.6))';
    el.style.opacity = 0.95;
    const drift = rand(-30, 30);
    const rot   = rand(-30, 30);
    const dur   = rand(6, 10);
    el.style.animation = `fall ${dur}s linear forwards, sway ${dur}s ease-in-out forwards`;
    el.style.setProperty('--drift', drift + 'vw');
    el.style.setProperty('--rot', rot + 'deg');
    floaters.appendChild(el);
    setTimeout(()=> el.remove(), dur*1000 + 200);
  }
  function spawnBalloon(){
    const el = document.createElement('div');
    const size = rand(32, 64);
    el.className = 'balloon';
    el.style.position='absolute';
    el.style.left = rand(0, 100) + 'vw';
    el.style.top  = '-12vh';
    el.style.width = size+'px';
    el.style.height= size*1.3+'px';
    const color = choose(neon);
    el.style.borderRadius='999px';
    el.style.background= color;
    el.style.boxShadow = `0 0 28px ${color}aa, inset 0 -10px 18px rgba(0,0,0,.25)`;
    el.style.opacity = .88;
    const dur   = rand(7, 12);
    el.style.animation = `balloonFall ${dur}s linear forwards, flicker ${rand(1.4,2.2)}s ease-in-out infinite`;
    floaters.appendChild(el);
    setTimeout(()=> el.remove(), dur*1000 + 200);
  }

  // Emoji fall (reduced density = 25% of normal)
  let flowerTimer = 0, balloonTimer = 0;
  function overlayTick(dt){
    flowerTimer += dt; balloonTimer += dt;
    if(flowerTimer > 1100){ // every ~1.1s spawn 1 (light density)
      spawnFlower(); flowerTimer = 0;
    }
    if(balloonTimer > 1400){ // ~1.4s
      spawnBalloon(); balloonTimer = 0;
    }
  }

  // CSS animations for floaters
  const style = document.createElement('style');
  style.textContent = `
    @keyframes fall{ to{ transform: translateY(110vh) rotate(var(--rot)); } }
    @keyframes sway{ 0%{ transform: translateX(0) } 100%{ transform: translateX(var(--drift)) } }
    @keyframes balloonFall{ to{ transform: translateY(115vh); } }
    @keyframes flicker{ 0%,100%{ filter:brightness(1)} 50%{ filter:brightness(1.14)} }
  `;
  document.head.appendChild(style);

  // Main render loops
  let lastT = performance.now();
  function loop(now){
    const dt = now - lastT; lastT = now;

    // Intensity from audio (0..1), ease towards it
    const level = getLevel();
    intensity += (level - intensity) * 0.15;

    // Confetti
    if(intensity > 0.25 && Math.random() < intensity*0.9) spawnConfetti( Math.ceil(rand(2, 6)) );
    ctxC.clearRect(0,0,canvasC.width,canvasC.height);
    confetti.forEach((p,i)=>{
      p.x += p.vx; p.y += p.vy; p.rot += p.vr;
      ctxC.save();
      ctxC.translate(p.x, p.y);
      ctxC.rotate(p.rot);
      ctxC.fillStyle = p.c;
      ctxC.fillRect(-p.r, -p.r, p.r*2, p.r*2);
      ctxC.restore();
      if(p.y > canvasC.height + 10) confetti.splice(i,1);
    });

    // Fireworks / sparks: burst more when beats are strong
    if(intensity > 0.55 && Math.random() < intensity*0.15) spawnFirework();

    ctxS.clearRect(0,0,canvasS.width,canvasS.height);
    fireworks.forEach((f,i)=>{
      f.t += 1;
      // draw subtle glow
      ctxS.beginPath();
      ctxS.arc(f.x, f.y, 2.2*DPR, 0, Math.PI*2);
      ctxS.fillStyle = f.c+'cc';
      ctxS.fill();
      if(f.t > 40) fireworks.splice(i,1);
    });

    for(let i=sparks.length-1;i>=0;i--){
      const s = sparks[i];
      s.x += s.vx; s.y += s.vy; s.life -= 1;
      ctxS.beginPath();
      ctxS.arc(s.x, s.y, 1.6*DPR, 0, Math.PI*2);
      ctxS.fillStyle = s.c;
      ctxS.fill();
      if(s.life <= 0) sparks.splice(i,1);
    }

    // Overlay DOM items tick
    overlayTick(dt);

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  // Start some minimal effects even before music (subtle)
  function startReactiveEffects(){
    // Kick a small burst immediately for delight
    spawnConfetti(20);
    spawnFirework();
  }

  // Accessibility: pressing Enter on button triggers click
  revealBtn.addEventListener('keyup', (e)=>{ if(e.key==='Enter' || e.key===' ') revealBtn.click(); });

})();
</script>
</body>
</html>